pico-8 cartridge // http://www.pico-8.com
version 16
__lua__
--returns generic box table
function getnewbox(x,y,w,h,s,c)
	return {x=x,y=y,w=w,h=h,s=s,c=c}
end

--p-8 default init
function _init()
	b={
		x=10,
		y=63,
		dx=2,
		dy=2,
		r=2,
		c=10
	}
	p=getnewbox(51,120,24,3,5,7)
	p.dx=0
	p.hc=8
	p.dc=p.c
end

--checks ball collision on
-- generic box table
function ballcollision(nextx,nexty,box)
	--x
	if nextx-b.r>box.x+box.w then
		return false
	end
	if nextx+b.r<box.x then
		return false
	end
	--y
	if nexty-b.r>box.y+box.h then
		return false
	end
	if nexty+b.r<box.y then
		return false
	end

	return true
end

function handleinput()
	local bpressed=false
	--moving paddle
	--left
	if btn(0) then
		p.dx=-p.s
		bpressed=true
	end
	--right
	if btn(1) then
		p.dx=p.s
		bpressed=true
	end
	--no button pressed,
	--slow down paddle
	if not(bpressed) then
		p.dx=p.dx/1.7
	end
	
	p.x+=p.dx
end

function deflect()

end

function handlepaddlebounds()
	if p.x<8 then
		p.x=8
	end
	if p.x+p.w>119 then
		p.x=119-p.w
	end
end

--p-8 default update
function _update()
	local nextx,nexty
 nextx=b.x+b.dx
	nexty=b.y+b.dy
	
	--ball edge collision
	--x
	if nextx+b.r>118 or nextx-b.r<8 then
		nextx=mid(8,nextx,118)
		b.dx=-b.dx
		sfx(0)
	end
	--y-top
	if nexty<0 or nexty+b.r>127 then
		nexty=mid(0,nexty,127)
		b.dy=-b.dy
		sfx(0)
	end
	p.c=p.dc
	--paddle-ball collision
	if ballcollision(nextx,nexty,p) then
		--find direction after collision
		if deflect(nextx,nexty,paddle) then
			b.dx=-b.dx
		else
			b.dy=-b.dy
		end
		p.c=p.hc
		sfx(1)
	end

	handleinput()
	handlepaddlebounds()
	
	b.x=nextx
	b.y=nexty
end

function _draw()
	cls()
	circfill(b.x,b.y,b.r,b.c)
	rectfill(p.x,p.y,p.x+p.w,p.y+p.h,p.c)
	map(0,0)
end
__gfx__
0000000006dd55606dd1155606dd5560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006dd55600000000006dd5560000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070006dd55606dd115566dd11556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700006dd5560000000006dd11556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700006dd55606dd115566dd11556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070006dd55606dd1155600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006dd55606dd115566dd11556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000006dd556006dd556000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0300000000000000000000000000000300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0100000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
00010000143501435014350143501a300013000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000100001f3501f3501f3501f35025300000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
